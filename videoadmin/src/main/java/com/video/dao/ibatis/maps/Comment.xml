<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Comment">
	<typeAlias alias="Comment" type="com.video.domain.Comment" />
	<resultMap id="Comment" class="Comment">
		<result property="id" column="id" />
		<result property="commentDate" column="comm_date" />
		<result property="comment" column="comm" />
		<result property="video.id" column="video_id" />
		<result property="user.id" column="user_id" />

	</resultMap>
	<resultMap id="CommentJoin" class="Comment">
		<result property="id" column="c.id" />
		<result property="commentDate" column="c.comm_date" />
		<result property="comment" column="c.comm" />
		<result property="video.id" column="v.id" />
		<result property="video.name" column="v.name" />
		<result property="user.id" column="u.id" />
		<result property="user.userName" column="u.username" />
	</resultMap>
	
	<select id="getCommentsByVideoId" parameterClass="java.lang.Long" resultMap="CommentJoin">
	select c.id,c.comm,c.comm_date,v.id,v.name,u.id,u.username from w_comments c left join w_video v on v.id = c.video_id 
	left join users u on u.id = c.user_id  where v.id = #value#
	</select>
	
	<delete id="deleteCommentById" parameterClass="java.lang.Long">
	delete from w_comments where id = #value#
	</delete>
	
	<select id="countComment"  parameterClass="com.video.util.Pagination" resultClass="int">
		select count(*) from w_comments
	</select>
	
	<select id="getComments" parameterClass="com.video.util.Pagination" resultMap="CommentJoin">
		select c.id,c.comm,c.comm_date,v.id,v.name,u.id,u.username from w_comments c left join w_video v on v.id = c.video_id 
	left join users u on u.id = c.user_id order by c.comm_date desc 
		
	  limit #startIndex#,#size#
		
	</select>
	
	
	
	
	
	
	
	</sqlMap>