<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Group">
	<typeAlias alias="Group" type="com.video.domain.Group" />
	<resultMap id="Group" class="Group">
		<result property="id" column="id" />
		<result property="owner.id" column="user_id" />
		<result property="descrption" column="description" />
		<result property="image" column="image" />
		<result property="addDate" column="adddate" />
		<result property="flag" column="flag" />
		<result property="name" column="name" />

	</resultMap>
	
	<resultMap id="RecommendGroup" class="Group">
		<result property="id" column="id" />
		<result property="name" column="name" />
		<result property="recommendDate" column="recommend_date" />

	</resultMap>
	
	
	
	<resultMap class="com.video.domain.User" id="GroupUser">
		<result property="id" column="id" />
		<result property="userName" column="username" />
	
	</resultMap>
	
	<resultMap id="GroupJoinMap" class="Group">
		<result property="id" column="g.id" />
		<result property="owner.id" column="u.id" />
		<result property="owner.userName" column="u.username" />
		<result property="descrption" column="g.description" />
		<result property="image" column="g.image" />
		<result property="addDate" column="g.adddate" />
		<result property="flag" column="g.flag" />
		<result property="name" column="g.name" />
	</resultMap>
	
	<select id="countGroup"  parameterClass="com.video.util.Pagination" resultClass="int">
		select count(*) from w_groups where flag !=0
	</select>
	
	<select id="getGroups" parameterClass="com.video.util.Pagination" resultMap="GroupJoinMap">
		select g.id,g.image,g.name,g.flag,g.adddate,g.description,u.id,u.username from w_groups g left join users u on g.user_id = u.id 
		  where g.flag !=0
	  limit #startIndex#,#size#
		
	</select>
	
	<update id="updateGroup" parameterClass="Group" >
	update w_groups set description=#descrption#,image=#image#,flag=#flag#,name=#name# where id=#id#
	
	</update>
	
	<select id="getGroupById" parameterClass="java.lang.Long" resultMap="GroupJoinMap">
	select g.id,g.image,g.name,g.flag,g.adddate,g.description,u.id,u.username from w_groups g left join users u on g.user_id = u.id 
		  where g.id = #value#
	</select>
	
	<select id="getOhterUsersByGroupId" parameterClass="com.video.util.Pagination" resultMap="GroupUser">
		select id,username from users where id not in(select user_id from w_group_user where group_id = #condition#  )
	 limit #startIndex#,#size#
	</select>
	
	<select id="getUsersByGroupId" parameterClass="com.video.util.Pagination" resultMap="GroupUser">
	
	select id,username from users where id  in(select user_id from w_group_user where group_id = #condition#  )
	 limit #startIndex#,#size#
	 </select>
	 
	 
	 <select id="countOhterUsersByGroupId"  parameterClass="com.video.util.Pagination" resultClass="int">
		select count(*) from users where id not in(select user_id from w_group_user where group_id = #condition#  )
	</select>
	
	 <select id="countUsersByGroupId"  parameterClass="com.video.util.Pagination" resultClass="int">
		select count(*) from users where id  in(select user_id from w_group_user where group_id = #condition#  )
	</select>
	
	<select id="getRecommendGroups" resultMap="RecommendGroup">
		select id,name,recommend_date from w_groups where recommend_date is not null order by recommend_date 
	</select>
	
	<update id="deleteRecommendGroups">
	update w_groups set recommend_date = null 
	
	</update>
	
	<update id="creatRecommendGroup" parameterClass="Group">
	update w_groups set recommend_date=#recommendDate# where id = #id#
	</update>
	</sqlMap>